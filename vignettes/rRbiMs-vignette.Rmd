---
title: "rRbiMs-vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{rRbiMs-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

*Mirna Vázquez Rosas Landa, Valerie de Anda Torres, Sahil Shan, and Brett Baker
1Marine Science Institute, The University of Texas at Austin 750 Channel View Drive, Port Aransas, TX 78373*


Our motivation to build rRbiMs is to create a workflow that helps researchers to explore metabolism data in a reproducible manner. It includes a custom-curated database that can be easily accessed by the user. rRbiMs key advantages are that 1) allows to incorporate different databases outputs, 2) it is based on modules that allow the user not to use the whole pipeline, and 3) it facilitates the incorporation of user’s metadata such as taxonomy and sampling data information, allowing to answer user-driven specific questions. 

The standard pipeline consists of four steps: read, mapping, sub-setting, and graphic plotting. In a typical workflow, the read and mapping steps utilize the output from KEGG to create a profile-abundance matrix organized by pathways. After mapping, the metadata can be added and used within the sub-setting step, which also allows multivariate analysis. Finally, the plot steps allow the generation of publication-quality figures and the exploration of data through custom visualization. rRbiMs is a user-friendly R workflow that allows the research community to perform reproducible and accurate microbial metabolism analyses.


### KEGG-based annotation analysis

Load the package:
```{r setup, include=FALSE}
devtools::load_all()
library(readxl)
metadata<-read_excel("../data/metadata.xlsx")
```

```{r Load package, eval=FALSE}
library(rRbiMs)
```

Read the KofamKOALA/KofamScan output.
```{r message=FALSE, warning=FALSE}
raw_ko_output<-read_ko("../data/KEGG_bins.txt")
```

The read_ko function will create a table that contains the abundance of each KO within each bin. 
```{r}
head(raw_ko_output)
```

Now we will use the function mapping_ko to mapp the KO ids to the main KEGG-based database.
```{r message=FALSE, warning=FALSE}
raw_ko_output<-mapping_ko(raw_ko_output)
```

The output is the abunance profile of each pathway and module acrooss the bins.
```{r}
head(raw_ko_output)
```

Here you can performed analysis using your metadata information. 
```{r eval=FALSE}
metadata<read_excel("../data/metadata.xlsx")
```

In this case, which KO are only present in the bins found in the water column?
```{r}
ko_subsett<-get_unique(raw_ko_output, metadata, Sample_site, "Water_column")
```

```{r}
head(ko_subsett)
```

Now lets plot the subset. The plot_bubble_percentage will calculate the relative abundance of certain module or pathway in certain bin. The functions allow to color code acording to any metadata information.

```{r fig.height=5, fig.width=10}
plot_bubble_percentage(raw_ko_output, metadata, "Bin_name", Module_description, "Percentage", "Clades")
```





