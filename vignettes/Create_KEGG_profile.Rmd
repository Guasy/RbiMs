---
title: "Create KEGG profile"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Create KEGG profile}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

First, load the rbims package.

```{r setup}
library(rbims)
```

The second thing to do would be read the [KofamKOALA/KofamScan](https://github.com/mirnavazquez/RbiMs/blob/main/inst/extdata/KEGG_bins.txt) output. 

## Read the KEGG results

The function that rbims use to read the input table is [read_ko](https://mirnavazquez.github.io/RbiMs/reference/read_ko.html). And it reads the raw output from the  KofamKOALA/KofamScan programs.

```{r eval=FALSE}
?read_ko
```

`rbims` contains a test dataset that allow us to test this function. This data are loaded when you install the package and are saved in the objects `ko_bin_table`, `ko_bin_mapp`, and `metadata`. You can download the [KofamKOALA/KofamScan](https://github.com/mirnavazquez/RbiMs/blob/main/inst/extdata/KEGG_bins.txt) example file and try. 

```{r eval=FALSE}
ko_bin_table<-read_ko(data_kofam ="KEGG_bins.txt")
```

The read_ko function will create a table that contains the abundance of each KO within each bin. 

```{r}
head(ko_bin_table)
```

## Map to the KEGG database

The function [mapping_ko](https://mirnavazquez.github.io/RbiMs/reference/mapping_ko.html) can be now used to map the KO and their abundance to the rest of the features of KEGG and rbims database.

```{r eval=FALSE}
ko_bin_mapp<-mapping_ko(ko_bin_table)
```

```{r}
head(ko_bin_mapp)
```

You can export this table in a table like this.

```{r}
write.table(ko_bin_mapp, "KEGG_mapped.tsv", quote = F, sep = "\t", row.names = F, col.names = T)
```



